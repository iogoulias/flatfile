<h2>If there's a different row for every presenter/chair, upload here:</h2>
  <label for="fname">Client:</label>
 <select id="fname" name="fname">
   <option value=""></option>
</select>
  <br><br>
<button onclick="importer.requestDataFromUser().then(async function(results) { 
importer.displayLoader();
var client=document.getElementById('fname').value;
if (client==null || client=='') {
client=12345;
}
var event_key=((client).split('_').slice(-1)).join('');
client=(((client).split('_')).slice(0,-1)).join('_');

var client_key=client;
client=client+'_'+(new Date()).toISOString();
    var data=(results.data);
	var speakers={};
	var sessions={};
	var presentations={};
	data=data.map(function(v){if(!v.hasOwnProperty('sessionid')){v['sessionid']=v['sessiontitle']};if ((v['sessionid']).trim()!='') {v['sessionid']=v['sessionid']+'_'+client_key};
	if(!v.hasOwnProperty('previous_email') || v['previous_email']==null){v['previous_email']=''};
    if(!v.hasOwnProperty('emailcc') || v['emailcc']==null){v['emailcc']=''};
    if(!v.hasOwnProperty('telephone') || v['telephone']==null){v['telephone']=''};
    if(!v.hasOwnProperty('telephone2') || v['telephone2']==null){v['telephone2']=''};
    if(!v.hasOwnProperty('organisation') || v['organisation']==null){v['organisation']=''};
    if(!v.hasOwnProperty('positionorganisation') || v['positionorganisation']==null){v['positionorganisation']=''};
    if(!v.hasOwnProperty('username') || v['username']==null){v['username']=''};
    if(!v.hasOwnProperty('password') || v['password']==null){v['password']=''};
    if(!v.hasOwnProperty('url') || v['url']==null){v['url']=''};
    if(!v.hasOwnProperty('pin') || v['pin']==null){v['pin']=''};
    if(!v.hasOwnProperty('url2') || v['url2']==null){v['url2']=''};
    if(!v.hasOwnProperty('remotecode') || v['remotecode']==null){v['remotecode']=''};
    if(!v.hasOwnProperty('videodisplay2') || v['videodisplay2']==null){v['videodisplay2']=''};
    if(!v.hasOwnProperty('eventfield1') || v['eventfield1']==null){v['eventfield1']=''};
    if(!v.hasOwnProperty('eventfield2') || v['eventfield2']==null){v['eventfield2']=''};
    if(!v.hasOwnProperty('eventfield3') || v['eventfield3']==null){v['eventfield3']=''};
	if(!v.hasOwnProperty('presentationtitle') || v['presentationtitle']==null || v['presentationtitle']==''){v['presentationtitle']=v['sessiontitle']};
	if(!v.hasOwnProperty('presentationfrom') || v['presentationfrom']==null || v['presentationfrom']==''){v['presentationfrom']=v['sessionfrom']};
	if(!v.hasOwnProperty('presentationto') || v['presentationto']==null || v['presentationto']==''){v['presentationto']=v['sessionto']};
	if(!v.hasOwnProperty('presentationid') || v['presentationid']==null || v['presentationid']==''){v['presentationid']=v['presentationtitle']+'_'+String(v['email']).toLowerCase()};if ((v['presentationid']).trim()!='') {v['presentationid']=v['presentationid']+'_'+client_key};
	if(!v.hasOwnProperty('presentationtype') || v['presentationtype']==null || v['presentationtype']==''){v['presentationtype']=v['sessiontype']};
	if(!v.hasOwnProperty('presentertitle') || v['presentertitle']==null ){v['presentertitle']=''}; v['email']=String(v['email']).toLowerCase(); if((!v.hasOwnProperty('email') || v['email']==null || v['email']=='') && (!v.hasOwnProperty('speakerid') || v['speakerid']==null || v['speakerid']=='') ){v['email']=(v['presentertitle']+' '+v['firstname']+' '+v['lastname']).trim()};
    if(!v.hasOwnProperty('speakerid') || v['speakerid']==null || v['speakerid']==''){v['speakerid']=v['email']};if ((v['speakerid']).trim()!='') {v['speakerid']=v['speakerid']+'_'+client_key};
	return v})
	for (var i=0;i<data.length;i++) {
	if (!speakers.hasOwnProperty(data[i]['speakerid'])) {
		console.log('previous_email: '+data[i]['previous_email'])
	speakers[data[i]['speakerid']]={
		'Speaker attendance status':data[i]['speakerattendance'],'Gender':data[i]['gender'],'Email CC':data[i]['emailcc'],
	'Telephone':data[i]['telephone'],'Alternative Contact Number':data[i]['telephone2'],'Organisation':data[i]['organisation'],'Position within organisation':data[i]['positionorganisation'],
		'Name':(data[i]['presentertitle']+' '+data[i]['firstname']+' '+data[i]['lastname']).trim(),
	'ImportId':client,'Title':data[i]['presentertitle'],'Event ID':event_key,'Previous Email':data[i]['previous_email'],'Speaker import ID':data[i]['speakerid'],'First name':data[i]['firstname'],'Last name':data[i]['lastname'],'Email':data[i]['email'],'City':data[i]['city'],'Country':data[i]['country']
	}
	if (data[i]['role']=='Speaker' || data[i]['role']=='co-Speaker') {
	speakers[data[i]['speakerid']]['Speaking Sessions']=[data[i]['sessionid']]
	speakers[data[i]['speakerid']]['Moderating Sessions']=[];
	} else {
	speakers[data[i]['speakerid']]['Moderating Sessions']=[data[i]['sessionid']]
	speakers[data[i]['speakerid']]['Speaking Sessions']=[];	
	}
	} else {
	
	if (data[i]['role']=='Speaker' || data[i]['role']=='co-Speaker') {
	(speakers[data[i]['speakerid']]['Speaking Sessions']).push(data[i]['sessionid']);
	} else {
	(speakers[data[i]['speakerid']]['Moderating Sessions']).push(data[i]['sessionid'])
	}
	
	}
	
	if (!sessions.hasOwnProperty(data[i]['sessionid'])) {
	sessions[data[i]['sessionid']]={'Session import ID':data[i]['sessionid'],'Event ID':event_key,'ImportId':client,'Name':data[i]['sessiontitle'],'Start time':data[i]['sessionfrom'],'End time':data[i]['sessionto'],'Date':data[i]['sessiondate'],'Session type':data[i]['sessiontype'],'Stage':data[i]['room']}
	
		if (data[i]['role']=='Speaker' || data[i]['role']=='co-Speaker') {
		sessions[data[i]['sessionid']]['Speakers']=[data[i]['speakerid']];
		sessions[data[i]['sessionid']]['Moderators']=[];
		} else {			
		sessions[data[i]['sessionid']]['Speakers']=[];
		sessions[data[i]['sessionid']]['Moderators']=[data[i]['speakerid']];
		}
	
	} else {
	if (data[i]['role']=='Speaker' || data[i]['role']=='co-Speaker') {
	(sessions[data[i]['sessionid']]['Speakers']).push(data[i]['speakerid']);
	} else {
	(sessions[data[i]['sessionid']]['Moderators']).push(data[i]['speakerid']);	
	}
	
	}
	
	//if (data[i]['role']=='Speaker') {
	if (!presentations.hasOwnProperty(data[i]['presentationid'])) {
	presentations[data[i]['presentationid']]={
		'Username (misc - presentation specific)':data[i]['username'],
'Password (misc - presentation specific)':data[i]['password'],
'Video Platform URL (presentation specific)':data[i]['url'],
'Video platform password/PIN (presentation specific)':data[i]['pin'],
'Moderation tool URL (presentation specific)':data[i]['url2'],
'Remote clicker tool code (presentation specific)':data[i]['remotecode'],
'Video display name (presentation specific)':data[i]['videodisplay2'],
'Event specific presentation field 1':data[i]['eventfield1'],
'Event specific presentation field 2':data[i]['eventfield2'],
'Event specific presentation field 3':data[i]['eventfield3'],
'Pre-record vs live':data[i]['prerecordorlive'],
'Physical speaker status':data[i]['physicalspeakerstatus'],
'Presentation language':data[i]['language'],
		'Role':data[i]['role'],'Presentation import ID':data[i]['presentationid'],'Event ID':event_key,'ImportId':client,'Name':data[i]['presentationtitle'],'Start time':data[i]['presentationfrom'],'End time':data[i]['presentationto'],'Date':data[i]['sessiondate'],'Presentation type':data[i]['presentationtype']}
	presentations[data[i]['presentationid']]['Sessions']=[data[i]['sessionid']];
    presentations[data[i]['presentationid']]['Speakers']=[data[i]['speakerid']];	
	} else {
	(presentations[data[i]['presentationid']]['Speakers']).push(data[i]['speakerid']);
    (presentations[data[i]['presentationid']]['Sessions']).push(data[i]['sessionid']);	
	}
	//}
	
	}
	console.log(speakers);
	console.log(sessions);
	var sessions_arr=[];
	var speakers_arr=[];
	var presentations_arr=[];
	for (var key in speakers) {
	speakers_arr.push(speakers[key]);
	}
	for (var key in sessions) {
	sessions_arr.push(sessions[key]);
	}
	for (var key in presentations) {
	presentations_arr.push(presentations[key]);
	}
	sessions=sessions_arr;
	speakers=speakers_arr;
	presentations=presentations_arr;
    sessions=sessions.map(function(value){value['Speakers']=(value['Speakers']).join('||'); return value});
	sessions=sessions.map(function(value){value['Moderators']=(value['Moderators']).join('||'); return value});
	speakers=speakers.map(function(value){value['Speaking Sessions']=(value['Speaking Sessions']).join('||'); return value});
	speakers=speakers.map(function(value){value['Moderating Sessions']=(value['Moderating Sessions']).join('||'); return value});
    presentations=presentations.map(function(value){value['Speakers']=(value['Speakers']).join('||'); return value});
    presentations=presentations.map(function(value){value['Sessions']=(value['Sessions']).join('||'); return value});
var payload={'records':[]};
var payload2={'records':[]};
var payload3={'records':[]};
	for (var i=0;i<sessions.length;i++) {
payload.records.push({'fields':sessions[i]})
}
	for (var i=0;i<speakers.length;i++) {
payload2.records.push({'fields':speakers[i]})
}
	for (var i=0;i<presentations.length;i++) {
payload3.records.push({'fields':presentations[i]})
}
await airtable(payload,'Sessions%20Import');
await wait(200);
await airtable(payload2,'Speakers%20Import');
await wait(200);
await airtable(payload3,'Presentations%20Import')
async function airtable(payload,table) {
    var airtableresp = await fetch('https://api.airtable.com/v0/appPSTd2LHQfE0SE7/'+table, {
    'method': 'POST',
    'headers': {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer '+'keyjBiRLhAGxVa5J9'
    },
    'body': JSON.stringify({records:payload.records.slice(0,10)})
  }).then(x=>x.json()).then(
  async function(data){
  console.log(data);
  payload.records=payload.records.slice(10)
  if (payload.records.length>0) {
  await wait(200)
  await airtable(payload,table)
  }
  })
  
  }
  
  
   function wait(ms) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log('Done waiting');
      resolve(ms)
    }, ms )
  })
}
	
	
	
    importer.displaySuccess('Thanks for uploading your data!')
})">Start Import</button>
<h2>Otherwise upload here:</h2>
  <label for="fname2">Client:</label>

  <select id="fname2" name="fname">
  <option value=""></option>
 </select>
 <br><br>
<button onclick="importer2.requestDataFromUser().then(async function(results) { 
importer2.displayLoader();
var client=document.getElementById('fname2').value;
if (client==null || client=='') {
client=12345;
}

var event_key=((client).split('_').slice(-1)).join('');
client=(((client).split('_')).slice(0,-1)).join('_');
var client_key=client;
client=client+'_'+(new Date()).toISOString();
    var data=(results.data);
	var speakers={};
	var sessions={};
	var presentations={};
	var addedchairs={};
	var addedchairspresentations={};
	data=data.map(function(v){if(!v.hasOwnProperty('sessionid')){v['sessionid']=v['sessiontitle']};if ((v['sessionid']).trim()!='') {v['sessionid']=v['sessionid']+'_'+client_key}; 
	if(!v.hasOwnProperty('previous_email') || v['previous_email']==null){v['previous_email']=''};
	if(!v.hasOwnProperty('previous_email_chair1') || v['previous_email_chair1']==null){v['previous_email_chair1']=''};
	if(!v.hasOwnProperty('previous_email_chair2') || v['previous_email_chair2']==null){v['previous_email_chair2']=''};
	if(!v.hasOwnProperty('previous_email_chair3') || v['previous_email_chair3']==null){v['previous_email_chair3']=''};
	if(!v.hasOwnProperty('previous_email_chair4') || v['previous_email_chair4']==null){v['previous_email_chair4']=''};
	if(!v.hasOwnProperty('previous_email_chair5') || v['previous_email_chair5']==null){v['previous_email_chair5']=''};
    if(!v.hasOwnProperty('emailcc') || v['emailcc']==null){v['emailcc']=''};
    if(!v.hasOwnProperty('telephone') || v['telephone']==null){v['telephone']=''};
    if(!v.hasOwnProperty('telephone2') || v['telephone2']==null){v['telephone2']=''};
    if(!v.hasOwnProperty('organisation') || v['organisation']==null){v['organisation']=''};
    if(!v.hasOwnProperty('positionorganisation') || v['positionorganisation']==null){v['positionorganisation']=''};
    if(!v.hasOwnProperty('username') || v['username']==null){v['username']=''};
    if(!v.hasOwnProperty('password') || v['password']==null){v['password']=''};
    if(!v.hasOwnProperty('url') || v['url']==null){v['url']=''};
    if(!v.hasOwnProperty('pin') || v['pin']==null){v['pin']=''};
    if(!v.hasOwnProperty('url2') || v['url2']==null){v['url2']=''};
    if(!v.hasOwnProperty('remotecode') || v['remotecode']==null){v['remotecode']=''};
    if(!v.hasOwnProperty('videodisplay2') || v['videodisplay2']==null){v['videodisplay2']=''};
    if(!v.hasOwnProperty('eventfield1') || v['eventfield1']==null){v['eventfield1']=''};
    if(!v.hasOwnProperty('eventfield2') || v['eventfield2']==null){v['eventfield2']=''};
    if(!v.hasOwnProperty('eventfield3') || v['eventfield3']==null){v['eventfield3']=''};
	if(!v.hasOwnProperty('presentationtitle') || v['presentationtitle']==null || v['presentationtitle']==''){v['presentationtitle']=v['sessiontitle']};
	if(!v.hasOwnProperty('presentationfrom') || v['presentationfrom']==null || v['presentationfrom']==''){v['presentationfrom']=v['sessionfrom']};
	if(!v.hasOwnProperty('presentationto') || v['presentationto']==null || v['presentationto']==''){v['presentationto']=v['sessionto']};
	if(!v.hasOwnProperty('presentationid') || v['presentationid']==null || v['presentationid']==''){v['presentationid']=v['presentationtitle']+'_'+String(v['email']).toLowerCase()};if ((v['presentationid']).trim()!='') {v['presentationid']=v['presentationid']+'_'+client_key};
	if(!v.hasOwnProperty('presentationtype') || v['presentationtype']==null || v['presentationtype']==''){v['presentationtype']=v['sessiontype']};
	if(!v.hasOwnProperty('presentertitle') || v['presentertitle']==null ){v['presentertitle']=''};v['email']=String(v['email']).toLowerCase(); if((!v.hasOwnProperty('email') || v['email']==null || v['email']=='') && (!v.hasOwnProperty('speakerid') || v['speakerid']==null || v['speakerid']=='') ){v['email']=(v['presentertitle']+' '+v['firstname']+' '+v['lastname']).trim()};v['role']='Speaker';
if(!v.hasOwnProperty('speakerid') || v['speakerid']==null || v['speakerid']==''){v['speakerid']=v['email']};if ((v['speakerid']).trim()!='') {v['speakerid']=v['speakerid']+'_'+client_key};
	return v})
	var data2=[];
    for (var i=0;i<data.length;i++) {
		for (var k=1;k<6;k++) {
		
		    if ((data[i]['chair'+k+'_email']=='' || data[i]['chair'+k+'_email']==null) && (data[i]['chair'+k+'_lastname']!=null && data[i]['chair'+k+'_lastname']!='' ) ) {
			data[i]['chair'+k+'_email']=data[i]['chair'+k+'_firstname']+' '+data[i]['chair'+k+'_lastname']
			}
			if (
			((!addedchairs.hasOwnProperty(data[i]['sessionid']) || (addedchairs.hasOwnProperty(data[i]['sessionid']) && !(addedchairs[data[i]['sessionid']]).hasOwnProperty(data[i]['chair'+k+'_email']) )) && data[i]['chair'+k+'_email']!='' && data[i]['chair'+k+'_email']!=null)
			||
			((!addedchairspresentations.hasOwnProperty(data[i]['presentationid']) || (addedchairspresentations.hasOwnProperty(data[i]['presentationid']) && !(addedchairspresentations[data[i]['presentationid']]).hasOwnProperty(data[i]['chair'+k+'_email']) )) && data[i]['chair'+k+'_email']!='' && data[i]['chair'+k+'_email']!=null)
			) {
		var tempobj={ ...data[i]};
		tempobj['role']='Chair';
		tempobj['firstname']=data[i]['chair'+k+'_firstname'];
		tempobj['lastname']=data[i]['chair'+k+'_lastname'];
		tempobj['presentertitle']='';
		tempobj['presentationtitle']=data[i]['presentationtitle']
		tempobj['city']='';
		tempobj['country']='';
		tempobj['email']=String(data[i]['chair'+k+'_email']).toLowerCase();
		tempobj['speakerid']=tempobj['email']+'_'+client_key;
		tempobj['presentationid']=data[i]['presentationid']+'_'+tempobj['email'];
		tempobj['previous_email']=String(data[i]['previous_email_chair'+k]).toLowerCase();
		tempobj['presentationfrom']=data[i]['presentationfrom'];
		tempobj['presentationto']=data[i]['presentationto'];
		tempobj['sessiondate']=data[i]['sessiondate'];
		tempobj['presentationtype']=data[i]['presentationtype'];
		tempobj['speakerattendance']='Confirmed';
        tempobj['gender']='';
        tempobj['emailcc']='';
        tempobj['telephone']='';
        tempobj['telephone2']='';
        tempobj['organisation']='';
        tempobj['positionorganisation']='';
        tempobj['username']=data[i]['username'];
        tempobj['password']=data[i]['password'];
        tempobj['url']=data[i]['url'];
        tempobj['pin']=data[i]['pin'];
        tempobj['url2']=data[i]['url2'];
        tempobj['remotecode']=data[i]['remotecode'];
        tempobj['videodisplay2']=data[i]['videodisplay2'];
        tempobj['eventfield1']=data[i]['eventfield1'];
        tempobj['eventfield2']=data[i]['eventfield2'];
        tempobj['eventfield3']=data[i]['eventfield3'];
        tempobj['prerecordorlive']=data[i]['prerecordorlive'];
        tempobj['physicalspeakerstatus']=data[i]['physicalspeakerstatus'];
        tempobj['language']=data[i]['language'];

		data2.push({ ...tempobj })
		console.log(tempobj)
		console.log('k: '+k);
		console.log('chair_k_email: '+String(data[i]['chair'+k+'_email']).toLowerCase())
		console.log('tempobj email: '+tempobj['email'])
		console.log('data2 last email: '+data2[data2.length-1]['email'])
		console.log(data2.length)
		if (!addedchairs.hasOwnProperty(data[i]['sessionid'])) { 
		addedchairs[data[i]['sessionid']]={};
		}
		if (!addedchairspresentations.hasOwnProperty(data[i]['presentationid'])) { 
		addedchairspresentations[data[i]['presentationid']]={};
		}
		addedchairspresentations[data[i]['presentationid']][data[i]['chair'+k+'_email']]=1;
		addedchairs[data[i]['sessionid']][data[i]['chair'+k+'_email']]=1;
			}
		}
	}
	data=data.concat(data2);
	var includekeys={'speakerattendance':1,
'gender':1,
'emailcc':1,
'telephone':1,
'telephone2':1,
'organisation':1,
'positionorganisation':1,
'username':1,
'password':1,
'url':1,
'pin':1,
'url2':1,
'remotecode':1,
'videodisplay2':1,
'eventfield1':1,
'eventfield2':1,
'eventfield3':1,
'prerecordorlive':1,
'physicalspeakerstatus':1,
'language':1,'speakerid':1,'previous_email':1,'presentationid':1,'presentationtitle':1,'presentationfrom':1,'presentationto':1,'presentationtype':1,'presentertitle':1,'firstname':1,'lastname':1,'email':1,'city':1,'country':1,'sessiontitle':1,'sessiondate':1,'sessionfrom':1,'sessionto':1,'sessiontype':1,'room':1,'role':1,'sessionid':1}
    data=data.map(function(v){
		var newv={};
		for (var key in v) { if (includekeys.hasOwnProperty(key)) { newv[key]=v[key]}}
		return newv;
	})
    for (var i=0;i<data.length;i++) {
	if (!speakers.hasOwnProperty(data[i]['speakerid'])) {
	speakers[data[i]['speakerid']]={'Speaker attendance status':data[i]['speakerattendance'],'Gender':data[i]['gender'],'Email CC':data[i]['emailcc'],
	'Telephone':data[i]['telephone'],'Alternative Contact Number':data[i]['telephone2'],'Organisation':data[i]['organisation'],'Position within organisation':data[i]['positionorganisation'],
	'Title':data[i]['presentertitle'],'Name':(data[i]['presentertitle']+' '+data[i]['firstname']+' '+data[i]['lastname']).trim(),
	'ImportId':client,'First name':data[i]['firstname'],'Event ID':event_key,'Last name':data[i]['lastname'],'Speaker import ID':data[i]['speakerid'],'Previous Email':data[i]['previous_email'],'Email':data[i]['email'],'City':data[i]['city'],'Country':data[i]['country']
	}
	
	if (data[i]['role']=='Speaker') {
	speakers[data[i]['speakerid']]['Speaking Sessions']=[data[i]['sessionid']]
	speakers[data[i]['speakerid']]['Moderating Sessions']=[];
	} else {
	speakers[data[i]['speakerid']]['Moderating Sessions']=[data[i]['sessionid']]
	speakers[data[i]['speakerid']]['Speaking Sessions']=[];	
	}
	
	} else {
	if (data[i]['role']=='Speaker') {
	(speakers[data[i]['speakerid']]['Speaking Sessions']).push(data[i]['sessionid']);
	} else {
	(speakers[data[i]['speakerid']]['Moderating Sessions']).push(data[i]['sessionid'])
	}
	}
	
	if (!sessions.hasOwnProperty(data[i]['sessionid'])) {
	sessions[data[i]['sessionid']]={'Session import ID':data[i]['sessionid'],'Event ID':event_key,'ImportId':client,'Name':data[i]['sessiontitle'],'Start time':data[i]['sessionfrom'],'End time':data[i]['sessionto'],'Date':data[i]['sessiondate'],'Session type':data[i]['sessiontype'],'Stage':data[i]['room']}
	
		if (data[i]['role']=='Speaker') {
		sessions[data[i]['sessionid']]['Speakers']=[data[i]['speakerid']];
		sessions[data[i]['sessionid']]['Moderators']=[];
		} else {			
		sessions[data[i]['sessionid']]['Speakers']=[];
		sessions[data[i]['sessionid']]['Moderators']=[data[i]['speakerid']];
		}
	
	} else {
	if (data[i]['role']=='Speaker') {
	(sessions[data[i]['sessionid']]['Speakers']).push(data[i]['speakerid'])
	} else {
	(sessions[data[i]['sessionid']]['Moderators']).push(data[i]['speakerid'])	
	}
	
	}
	
	//if (data[i]['role']=='Speaker') {
	if (!presentations.hasOwnProperty(data[i]['presentationid'])) {
	presentations[data[i]['presentationid']]={
		'Username (misc - presentation specific)':data[i]['username'],
'Password (misc - presentation specific)':data[i]['password'],
'Video Platform URL (presentation specific)':data[i]['url'],
'Video platform password/PIN (presentation specific)':data[i]['pin'],
'Moderation tool URL (presentation specific)':data[i]['url2'],
'Remote clicker tool code (presentation specific)':data[i]['remotecode'],
'Video display name (presentation specific)':data[i]['videodisplay2'],
'Event specific presentation field 1':data[i]['eventfield1'],
'Event specific presentation field 2':data[i]['eventfield2'],
'Event specific presentation field 3':data[i]['eventfield3'],
'Pre-record vs live':data[i]['prerecordorlive'],
'Physical speaker status':data[i]['physicalspeakerstatus'],
'Presentation language':data[i]['language'],
		'Role':data[i]['role'],'Presentation import ID':data[i]['presentationid'],'Event ID':event_key,'ImportId':client,'Name':data[i]['presentationtitle'],'Start time':data[i]['presentationfrom'],'End time':data[i]['presentationto'],'Date':data[i]['sessiondate'],'Presentation type':data[i]['presentationtype']}
	presentations[data[i]['presentationid']]['Sessions']=[data[i]['sessionid']];
    presentations[data[i]['presentationid']]['Speakers']=[data[i]['speakerid']];	
	} else {
	(presentations[data[i]['presentationid']]['Speakers']).push(data[i]['speakerid']);
    (presentations[data[i]['presentationid']]['Sessions']).push(data[i]['sessionid']);	
	}
	//}
	
	}
	console.log(speakers)
	console.log(sessions)
	console.log(presentations)
	var sessions_arr=[];
	var speakers_arr=[];
	var presentations_arr=[];
	for (var key in speakers) {
	speakers_arr.push(speakers[key])
	}
	for (var key in sessions) {
	sessions_arr.push(sessions[key])
	}
	for (var key in presentations) {
	presentations_arr.push(presentations[key]);
	}
	sessions=sessions_arr;
	speakers=speakers_arr;
	presentations=presentations_arr;
    sessions=sessions.map(function(value){value['Speakers']=(value['Speakers']).join('||'); return value});
	sessions=sessions.map(function(value){value['Moderators']=(value['Moderators']).join('||'); return value});
	speakers=speakers.map(function(value){value['Speaking Sessions']=(value['Speaking Sessions']).join('||'); return value});
	speakers=speakers.map(function(value){value['Moderating Sessions']=(value['Moderating Sessions']).join('||'); return value});
    presentations=presentations.map(function(value){value['Speakers']=(value['Speakers']).join('||'); return value});
    presentations=presentations.map(function(value){value['Sessions']=(value['Sessions']).join('||'); return value});
var payload={'records':[]};
var payload2={'records':[]};
var payload3={'records':[]};
	for (var i=0;i<sessions.length;i++) {
payload.records.push({'fields':sessions[i]})
}
	for (var i=0;i<speakers.length;i++) {
payload2.records.push({'fields':speakers[i]})
}
	for (var i=0;i<presentations.length;i++) {
payload3.records.push({'fields':presentations[i]})
}
await airtable(payload,'Sessions%20Import');
await wait(200);
await airtable(payload2,'Speakers%20Import');
await wait(200);
await airtable(payload3,'Presentations%20Import');
async function airtable(payload,table) {
    var airtableresp = await fetch('https://api.airtable.com/v0/appPSTd2LHQfE0SE7/'+table, {
    'method': 'POST',
    'headers': {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer '+'keyjBiRLhAGxVa5J9'
    },
    'body': JSON.stringify({records:payload.records.slice(0,10)})
  }).then(x=>x.json()).then(
  async function(data){
  console.log(data);
  payload.records=payload.records.slice(10)
  if (payload.records.length>0) {
  await wait(200)
  await airtable(payload,table)
  }
  })
  
  }
  
  
   function wait(ms) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      console.log('Done waiting');
      resolve(ms)
    }, ms )
  })
}
	
	
	
    importer2.displaySuccess('Thanks for uploading your data!')
})">Start Import</button>
<script  src="https://unpkg.com/@flatfile/adapter/build/dist/index.min.js"></script>

<script type="module" >


var airtable_events=await fetchAirtableEvents();
console.log(airtable_events["dictionary"]);
for (var key in airtable_events["dictionary"]) {
document.getElementById('fname').options.add(new Option(key, key+"_"+airtable_events["dictionary"][key]))	
document.getElementById('fname2').options.add(new Option(key, key+"_"+airtable_events["dictionary"][key]))
}

async function fetchAirtableEvents() {

    var APIkey="keyjBiRLhAGxVa5J9";
    var baseId="appPSTd2LHQfE0SE7";
    var table="Event%20Details";
    var maxRecords=100;
    var offset=0;
    var cont=true;
    var events=[];
    while (cont) {
    var wait=false;
	var airtable=await customfetch("https://api.airtable.com/v0/"+baseId+"/"+table+"?maxRecords="+maxRecords+"&offset="+offset,{
    "method": "GET",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Bearer "+APIkey
    }
  })

    if (airtable.hasOwnProperty("offset")) {
    offset=airtable.offset;
    wait=true;
    } else {
    cont=false;
    }
  airtable=airtable.records;
  airtable=airtable.map(function(value){return [value.id,value.fields["Event name"]]})
  var airtabledictionary={};
      for (var i=0;i<airtable.length;i++) {
           airtabledictionary[airtable[i][1]]=airtable[i][0];
           }
      airtable=airtable.map(function(value){return value[1]})
  console.log(airtable.length)
  if (wait) {
  Utilities.sleep(250);
  }
  events=events.concat(airtable)
    }
  console.log(events)
  //  "payload": JSON.stringify(payload)
  
  // /api/Order/GetOrderDetail
  return {"events":events,"dictionary":airtabledictionary}
}

async function customfetch(url,options) {
return await fetch(url,options).then(x=>x.json()).then(function(v){ return v})
}

 //console.log( await fetchAirtableEvents())
</script>
<script>
//  validators:[{validate:'regex_matches',regex:"^(Chair)|(Speaker)$",error: 'Invalid Role Format or Empty Field'}]
const importer = new FlatfileImporter("bd4ed93e-83cb-4d62-a5b7-4a18ebdb9ce2", {
  type: "imports",
  fields: [
      {key: "firstname", label: "Speaker First name"},
	  {key: "lastname", label: "Speaker Last Name"},
	  {key: "presentertitle", label: "Speaker Title"},
	  {key: "speakerid", label: "Speaker ID"},
	  {key: "speakerattendance", label: "Speaker attendance status", type: "select",
    options: [
        { value: "Pencilled", label: "Pencilled"   },
        { value: "Confirmed", label: "Confirmed" },
		{ value: "Cancelled", label: "Cancelled" }
    ]},
	  {key: "emailcc", label: "Email CC", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "telephone", label: "Telephone", validators:[{validate:'regex_matches',regex:"^(\\+\\d{1,2}\\s)?\\(?\\d{3}\\)?[\\s.-]?\\d{3}[\\s.-]?\\d{4}$", error:'Invalid Telephone Format'}]},
	  {key: "telephone2", label: "Alternative Contact Number", validators:[{validate:'regex_matches',regex:"^(\\+\\d{1,2}\\s)?\\(?\\d{3}\\)?[\\s.-]?\\d{3}[\\s.-]?\\d{4}$", error:'Invalid Telephone Format'}]},
	  {key: "gender", label: "Gender", type: "select",
    options: [
        { value: "Male", label: "Male"   },
        { value: "Female", label: "Female" }
    ]},
	  {key: "organisation", label: "Organisation"},
	  {key: "positionorganisation", label: "Position within organisation"},
	  {key: "language", label: "Presentation language", type: "select",
    options: [
        { value: "English", label: "English"   },
        { value: "French", label: "French" },
	    { value: "Spanish", label: "Spanish" },
		{ value: "German", label: "German" },
		{ value: "Chinese", label: "Chinese" }
    ]},
      {key: "username", label: "Username (misc - presentation specific)"},
      {key: "password", label: "Password (misc - presentation specific)"},
      {key: "url", label: "Video Platform URL (presentation specific)", validators:[{validate:"regex_matches",regex:"[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)"}]},
	  {key: "pin", label: "Video platform password/PIN (presentation specific)"},
      {key: "url2", label: "Moderation tool URL (presentation specific)", validators:[{validate:"regex_matches",regex:"[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)"}]},
	  {key: "remotecode", label: "Remote clicker tool code (presentation specific)"},
	  {key: "videodisplay2", label: "Video display name (presentation specific)"},
	  {key: "prerecordorlive", label: "Pre-record vs live", type: "select",
    options: [
        { value: "Pre-record", label: "Pre-record"   },
        { value: "Live", label: "Live" }
    ]},
	  {key: "physicalspeakerstatus", label: "Physical speaker status", type: "select",
    options: [
        { value: "Remote", label: "Remote"   },
        { value: "On-site", label: "On-site" }
    ]},
      {key: "eventfield1", label: "Event specific presentation field 1"},
      {key: "eventfield2", label: "Event specific presentation field 2"},
      {key: "eventfield3", label: "Event specific presentation field 3"},
	  {key: "email", label: "Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "previous_email", label: "Previous Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "city", label: "City"},
	  {key: "country", label: "Country"},
	  {key: "sessiontitle", label: "Session Title"},
	  {key: "sessiondate", label: "Session Date",validators:[{validate:'regex_matches',regex:"^(0[1-9]|[12][0-9]|3[01])[/](0[1-9]|1[012])[/](19|20)[0-9][0-9]$",error: 'Invalid Date Format or Empty Field'}]},
	  {key: "sessionfrom", label: "Session Start Time",validators:[{validate:'regex_matches',regex:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",error: 'Invalid Time Format or Empty Field'}]},
	  {key: "sessionto", label: "Session End Time", validators:[{validate:'regex_matches',regex:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",error: 'Invalid Time Format or Empty Field'}]},
	  {key: "sessiontype", label: "Session Type"},
	  {key: "room", label: "Stage"},
	  {key: "role", label: "Role (Speaker or Chair)", 
	   type: "select",
    options: [
        { value: "Chair", label: "Chair",  alternates: ["chair", "co-chair","co-Chair","Co-chair","Co-chair"] },
        { value: "Speaker", label: "Speaker", alternates: ["speaker"] },
		{ value: "co-Speaker", label: "co-Speaker", alternates: ["co-speaker","co-Speaker","Co-Speaker","co-Speaker"] }
    ]
	  
	},
	  {key: "sessionid", label: "Session ID"},
	  {key: "presentationtitle", label: "Presentation Title"},
	  {key: "presentationid", label: "Presentation ID"},
	  {key: "presentationfrom", label: "Presentation Start Time",validators:[{validate:'regex_matches',regex:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",error: 'Invalid Time Format or Empty Field'}]},
	  {key: "presentationto", label: "Presentation End Time",validators:[{validate:'regex_matches',regex:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",error: 'Invalid Time Format or Empty Field'}]},
	  {key: "presentationtype", label: "Presentation Type"}
	  
    ],
  managed: true,
  devMode:true
});
var client=document.getElementById('fname').value;
if (client==null || client=="") {
client=12345;
}
importer.setCustomer({userId: client});

importer.registerRecordHook(record => {
  let out = {}
  if (record.sessiondate && record.sessiondate!="" && record.sessiondate!=null && (record.sessiondate).match("(0[1-9]|[12][0-9]|3[01])[/](0[1-9]|1[012])[/](19|20)[0-9][0-9]")==null ) {
    out.sessiondate = {
      value: new Date(record.sessiondate).toLocaleDateString('fr'),
      info: [
        {
          message: 'Fixed Date Format',
          level: 'info'
        }
      ]
    }
  }
  if ( record.sessionfrom!=null && (record.sessionfrom).match(/\d\d:\d\d/gi)!=null && record.sessionfrom!=(record.sessionfrom).match(/\d\d:\d\d/gi)[0] ) {
  out.sessionfrom = {
      value: (record.sessionfrom).match(/\d\d:\d\d/gi)[0],
      info: [
        {
          message: 'Fixed Time Format',
          level: 'info'
        }
      ]  
  }
  }
  if ( record.sessionto!=null && (record.sessionto).match(/\d\d:\d\d/gi)!=null && record.sessionto!=(record.sessionto).match(/\d\d:\d\d/gi)[0] ) {
  out.sessionto = {
      value: (record.sessionto).match(/\d\d:\d\d/gi)[0],
      info: [
        {
          message: 'Fixed Time Format',
          level: 'info'
        }
      ]  
  }
  }
  
  if ( record.presentationfrom!=null && (record.presentationfrom).match(/\d\d:\d\d/gi)!=null && record.presentationfrom!=(record.presentationfrom).match(/\d\d:\d\d/gi)[0] ) {
  out.presentationfrom = {
      value: (record.presentationfrom).match(/\d\d:\d\d/gi)[0],
      info: [
        {
          message: 'Fixed Time Format',
          level: 'info'
        }
      ]  
  }
  }
  if ( record.presentationto!=null && (record.presentationto).match(/\d\d:\d\d/gi)!=null && record.presentationto!=(record.presentationto).match(/\d\d:\d\d/gi)[0] ) {
  out.presentationto = {
      value: (record.presentationto).match(/\d\d:\d\d/gi)[0],
      info: [
        {
          message: 'Fixed Time Format',
          level: 'info'
        }
      ]  
  }
  }
//  if (record.role!=null && record.role!="") {
//  if (((record.role).toLowerCase()).indexOf("speaker")>-1) {
//  out.role = {
//      value: "Speaker",
//      info: [
//        {
//          message: 'Fixed Role Format',
//          level: 'info'
//        }
//      ]  
//  }  
//  } else {
//  out.role = {
//      value: "Chair",
//      info: [
//        {
//          message: 'Fixed Role Format',
//          level: 'info'
//        }
//      ]  
//  }   
//  }
//  }
  if (!(record.role!=null && record.role!="")) {
  out.role = {
      value: "Speaker",
      info: [
        {
          message: 'Fixed Role Format',
          level: 'info'
        }
      ]  
  }    
  }
  
  if (!(record.speakerattendance!=null && record.speakerattendance!="")) {
  out.speakerattendance = {
      value: "Confirmed",
      info: [
        {
          message: 'Fixed Speaker Attendance Status Format',
          level: 'info'
        }
      ]  
  }    
  }

  if (!(record.gender!=null && record.gender!="")) {
  out.gender = {
      value: "Male",
      info: [
        {
          message: 'Fixed Gender Format',
          level: 'info'
        }
      ]  
  }    
  }
  
  if (!(record.language!=null && record.language!="")) {
  out.language = {
      value: "English",
      info: [
        {
          message: 'Fixed Language Format',
          level: 'info'
        }
      ]  
  }    
  }
  
  if (!(record.prerecordorlive!=null && record.prerecordorlive!="")) {
  out.prerecordorlive = {
      value: "In-person",
      info: [
        {
          message: 'Fixed Pre-record vs speaking in person Format',
          level: 'info'
        }
      ]  
  }    
  }
  
  if (!(record.physicalspeakerstatus!=null && record.physicalspeakerstatus!="")) {
  out.physicalspeakerstatus = {
      value: "On-site",
      info: [
        {
          message: 'Fixed Physical Speaker Status Format',
          level: 'info'
        }
      ]  
  }    
  }
  return out
})

const importer2 = new FlatfileImporter("bd4ed93e-83cb-4d62-a5b7-4a18ebdb9ce2", {
  type: "imports",
  fields: [
      {key: "firstname", label: "Speaker First Name"},
	  {key: "lastname", label: "Speaker Last Name"},
	  {key: "presentertitle", label: "Speaker Title"},
	  {key: "speakerid", label: "Speaker ID"},
	  {key: "speakerattendance", label: "Speaker attendance status", type: "select",
    options: [
        { value: "Pencilled", label: "Pencilled"   },
        { value: "Confirmed", label: "Confirmed" },
		{ value: "Cancelled", label: "Cancelled" }
    ]},
	  {key: "emailcc", label: "Email CC", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "telephone", label: "Telephone", validators:[{validate:'regex_matches',regex:"^(\\+\\d{1,2}\\s)?\\(?\\d{3}\\)?[\\s.-]?\\d{3}[\\s.-]?\\d{4}$", error:'Invalid Telephone Format'}]},
	  {key: "telephone2", label: "Alternative Contact Number", validators:[{validate:'regex_matches',regex:"^(\\+\\d{1,2}\\s)?\\(?\\d{3}\\)?[\\s.-]?\\d{3}[\\s.-]?\\d{4}$", error:'Invalid Telephone Format'}]},
	  {key: "gender", label: "Gender", type: "select",
    options: [
        { value: "Male", label: "Male"   },
        { value: "Female", label: "Female" }
    ]},
	  {key: "organisation", label: "Organisation"},
	  {key: "positionorganisation", label: "Position within organisation"},
	  {key: "language", label: "Presentation language", type: "select",
    options: [
        { value: "English", label: "English"   },
        { value: "French", label: "French" },
	    { value: "Spanish", label: "Spanish" },
		{ value: "German", label: "German" },
		{ value: "Chinese", label: "Chinese" }
    ]},
      {key: "username", label: "Username (misc - presentation specific)"},
      {key: "password", label: "Password (misc - presentation specific)"},
      {key: "url", label: "Video Platform URL (presentation specific)", validators:[{validate:"regex_matches",regex:"[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)"}]},
	  {key: "pin", label: "Video platform password/PIN (presentation specific)"},
      {key: "url2", label: "Moderation tool URL (presentation specific)", validators:[{validate:"regex_matches",regex:"[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)"}]},
	  {key: "remotecode", label: "Remote clicker tool code (presentation specific)"},
	  {key: "videodisplay2", label: "Video display name (presentation specific)"},
	  {key: "prerecordorlive", label: "Pre-record vs live", type: "select",
    options: [
        { value: "Pre-record", label: "Pre-record"   },
        { value: "Live", label: "Live" }
    ]},
	  {key: "physicalspeakerstatus", label: "Physical speaker status", type: "select",
    options: [
        { value: "Remote", label: "Remote"   },
        { value: "On-site", label: "On-site" }
    ]},
      {key: "eventfield1", label: "Event specific presentation field 1"},
      {key: "eventfield2", label: "Event specific presentation field 2"},
      {key: "eventfield3", label: "Event specific presentation field 3"},
	  {key: "email", label: "Speaker Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "previous_email", label: "Speaker Previous Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "city", label: "Speaker City"},
	  {key: "country", label: "Speaker Country"},
	  {key: "chair1_firstname", label: "Chair1 First Name"},
	  {key: "chair1_lastname", label: "Chair1 Last Name"},
	  {key: "chair1_email", label: "Chair1 Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "previous_email_chair1", label: "Chair 1 Previous Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "chair2_firstname", label: "Chair2 First Name"},
	  {key: "chair2_lastname", label: "Chair2 Last Name"},
	  {key: "chair2_email", label: "Chair2 Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "previous_email_chair2", label: "Chair 2 Previous Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "chair3_firstname", label: "Chair3 First Name"},
	  {key: "chair3_lastname", label: "Chair3 Last Name"},
	  {key: "chair3_email", label: "Chair3 Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "previous_email_chair3", label: "Chair 3 Previous Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "chair4_firstname", label: "Chair4 First Name"},
	  {key: "chair4_lastname", label: "Chair4 Last Name"},
	  {key: "chair4_email", label: "Chair4 Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "previous_email_chair4", label: "Chair4 Previous Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "chair5_firstname", label: "Chair5 First Name"},
	  {key: "chair5_lastname", label: "Chair5 Last Name"},
	  {key: "chair5_email", label: "Chair5 Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},	  	  
	  {key: "previous_email_chair5", label: "Chair5 Previous Email", validators:[{validate:'regex_matches',regex:"^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$",error: 'Invalid Email Format or Empty Field'}]},
	  {key: "sessiontitle", label: "Session Title"},
	  {key: "sessiondate", label: "Session Date",validators:[{validate:'regex_matches',regex:"^(0[1-9]|[12][0-9]|3[01])[/](0[1-9]|1[012])[/](19|20)[0-9][0-9]$",error: 'Invalid Date Format or Empty Field'}]},
	  {key: "sessionfrom", label: "Session Start Time",validators:[{validate:'regex_matches',regex:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",error: 'Invalid Time Format or Empty Field'}]},
	  {key: "sessionto", label: "Session End Time", validators:[{validate:'regex_matches',regex:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",error: 'Invalid Time Format or Empty Field'}]},
	  {key: "sessiontype", label: "Session Type"},
	  {key: "room", label: "Stage"},
	  {key: "sessionid", label: "Session ID"},
	  {key: "presentationtitle", label: "Presentation Title"},
	  {key: "presentationid", label: "Presentation ID"},
	  {key: "presentationfrom", label: "Presentation Start Time",validators:[{validate:'regex_matches',regex:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",error: 'Invalid Time Format or Empty Field'}]},
	  {key: "presentationto", label: "Presentation End Time",validators:[{validate:'regex_matches',regex:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",error: 'Invalid Time Format or Empty Field'}]},
	  {key: "presentationtype", label: "Presentation Type"}
    ],
  managed: true,
  devMode:true
});
var client=document.getElementById('fname2').value;
if (client==null || client=="") {
client=12345;
}
importer2.setCustomer({userId: client});

importer2.registerRecordHook(record => {
  let out = {}
  if (record.sessiondate && record.sessiondate!="" && record.sessiondate!=null && (record.sessiondate).match("(0[1-9]|[12][0-9]|3[01])[/](0[1-9]|1[012])[/](19|20)[0-9][0-9]")==null ) {
    out.sessiondate = {
      value: new Date(record.sessiondate).toLocaleDateString('fr'),
      info: [
        {
          message: 'Fixed Date Format',
          level: 'info'
        }
      ]
    }
  }
  if ( record.sessionfrom!=null && (record.sessionfrom).match(/\d\d:\d\d/gi)!=null && record.sessionfrom!=(record.sessionfrom).match(/\d\d:\d\d/gi)[0] ) {
  out.sessionfrom = {
      value: (record.sessionfrom).match(/\d\d:\d\d/gi)[0],
      info: [
        {
          message: 'Fixed Time Format',
          level: 'info'
        }
      ]  
  }
  }
  if ( record.sessionto!=null && (record.sessionto).match(/\d\d:\d\d/gi)!=null && record.sessionto!=(record.sessionto).match(/\d\d:\d\d/gi)[0] ) {
  out.sessionto = {
      value: (record.sessionto).match(/\d\d:\d\d/gi)[0],
      info: [
        {
          message: 'Fixed Time Format',
          level: 'info'
        }
      ]  
  }
  }
    if ( record.presentationfrom!=null && (record.presentationfrom).match(/\d\d:\d\d/gi)!=null && record.presentationfrom!=(record.presentationfrom).match(/\d\d:\d\d/gi)[0] ) {
  out.presentationfrom = {
      value: (record.presentationfrom).match(/\d\d:\d\d/gi)[0],
      info: [
        {
          message: 'Fixed Time Format',
          level: 'info'
        }
      ]  
  }
  }
  if ( record.presentationto!=null && (record.presentationto).match(/\d\d:\d\d/gi)!=null && record.presentationto!=(record.presentationto).match(/\d\d:\d\d/gi)[0] ) {
  out.presentationto = {
      value: (record.presentationto).match(/\d\d:\d\d/gi)[0],
      info: [
        {
          message: 'Fixed Time Format',
          level: 'info'
        }
      ]  
  }
  }
  
  if (!(record.speakerattendance!=null && record.speakerattendance!="")) {
  out.speakerattendance = {
      value: "Confirmed",
      info: [
        {
          message: 'Fixed Speaker Attendance Status Format',
          level: 'info'
        }
      ]  
  }    
  }

  if (!(record.gender!=null && record.gender!="")) {
  out.gender = {
      value: "Male",
      info: [
        {
          message: 'Fixed Gender Format',
          level: 'info'
        }
      ]  
  }    
  }
  
  if (!(record.language!=null && record.language!="")) {
  out.language = {
      value: "English",
      info: [
        {
          message: 'Fixed Language Format',
          level: 'info'
        }
      ]  
  }    
  }
  
  if (!(record.prerecordorlive!=null && record.prerecordorlive!="")) {
  out.prerecordorlive = {
      value: "In-person",
      info: [
        {
          message: 'Fixed Pre-record vs speaking in person Format',
          level: 'info'
        }
      ]  
  }    
  }
  
  if (!(record.physicalspeakerstatus!=null && record.physicalspeakerstatus!="")) {
  out.physicalspeakerstatus = {
      value: "On-site",
      info: [
        {
          message: 'Fixed Physical Speaker Status Format',
          level: 'info'
        }
      ]  
  }    
  }
  
  return out
})

</script>
